<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core">

<h:head>
	<meta charset="UTF-8" />
    <title>Gerenciamento de Alunos</title>
    
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .form-grid { border-spacing: 10px; border-collapse: separate; }
        .data-table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        .data-table th, .data-table td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        .data-table .header { background-color: #f2f2f2; }
        .btn-group button { margin-right: 10px; }
        .messages-error { color: #d9534f; list-style-type: none; padding: 0; }
        .messages-info { color: #5cb85c; list-style-type: none; padding: 0; }
        .nav-link { margin-bottom: 20px; display: inline-block; }
    </style>
</h:head>

<h:body>

    <h:link outcome="index" value="&larr; Voltar para a Página Inicial" styleClass="nav-link"/>
    
    <h1>Gerenciamento de Alunos</h1>

    <h:form>
        <fieldset>
            <legend>#{alunoBean.edicao ? 'Editar Aluno' : 'Cadastrar Novo Aluno'}</legend>

            <h:messages id="messages" globalOnly="false" styleClass="messages-info" errorClass="messages-error" />

            <h:panelGrid columns="2" styleClass="form-grid">

                <h:outputLabel value="Nome:" for="nome"/>
                <h:inputText id="nome" value="#{alunoBean.aluno.nome}" required="true" requiredMessage="O campo 'Nome' é obrigatório." size="40"/>

                <h:outputLabel value="Idade:" for="idade"/>
                <h:inputText id="idade" value="#{alunoBean.aluno.idade}" required="true" requiredMessage="O campo 'Idade' é obrigatório.">
                    <f:convertNumber integerOnly="true" />
                </h:inputText>

                <h:outputLabel value="CPF:" for="cpf"/>
                <h:inputText id="cpf" value="#{alunoBean.aluno.cpf}" required="true" requiredMessage="O campo 'CPF' é obrigatório." disabled="#{alunoBean.edicao}" maxlength="14" title="#{alunoBean.edicao ? 'O CPF não pode ser alterado.' : 'Digite o CPF do aluno'}"/>

				<h:outputLabel value="Email:" for="email" />
				<h:inputText id="email" value="#{alunoBean.aluno.email}"
					required="true" requiredMessage="O campo 'Email' é obrigatório."
					size="40" />

				<h:outputLabel value="Rua:" for="rua" />
				<h:inputText id="rua" value="#{alunoBean.aluno.endereco.rua}"
					required="true" requiredMessage="O campo 'Rua' é obrigatório."
					size="40" />

				<h:outputLabel value="Número:" for="numero" />
				<h:inputText id="numero" value="#{alunoBean.aluno.endereco.numero}"
					required="true" requiredMessage="O campo 'Número' é obrigatório." />

				<h:outputLabel value="Bairro:" for="bairro" />
				<h:inputText id="bairro" value="#{alunoBean.aluno.endereco.bairro}"
					required="true" requiredMessage="O campo 'Bairro' é obrigatório."
					size="40" />

				<h:outputLabel value="Cidade:" for="cidade" />
				<h:inputText id="cidade" value="#{alunoBean.aluno.endereco.cidade}"
					required="true" requiredMessage="O campo 'Cidade' é obrigatório."
					size="40" />

				<h:outputLabel value="Curso:" for="curso" />
				<h:selectOneMenu id="curso" value="#{alunoBean.cursoId}"
					required="true"
					requiredMessage="É obrigatório selecionar um curso.">
					<f:selectItem itemLabel="Selecione o Curso..." itemValue="#{null}"
						noSelectionOption="true" />
					<f:selectItems value="#{cursoBean.cursos}" var="cursoAtual"
						itemLabel="#{cursoAtual.nome}" itemValue="#{cursoAtual.id}" />
				</h:selectOneMenu>

				<h:panelGroup styleClass="btn-group">
                    <h:commandButton value="Gravar" action="#{alunoBean.gravarAluno}" rendered="#{!alunoBean.edicao}" />
                    <h:commandButton value="Atualizar" action="#{alunoBean.atualizarAluno}" rendered="#{alunoBean.edicao}" />
                    <h:commandButton value="Cancelar" action="#{alunoBean.cancelar}" rendered="#{alunoBean.edicao}" />
                </h:panelGroup>

            </h:panelGrid>
        </fieldset>

        <hr style="margin-top: 30px;" />
</h:form>
<h:form>
		<h2>Alunos Cadastrados</h2>
		<h:dataTable value="#{alunoBean.alunos}" var="alunoAtual"
			styleClass="data-table" headerClass="header">

			<h:column>
				<f:facet name="header">Nome</f:facet>
				<h:outputText value="#{alunoAtual.nome}" />
			</h:column>
			<h:column>
				<f:facet name="header">Idade</f:facet>
				<h:outputText value="#{alunoAtual.idade}" />
			</h:column>
			<h:column>
				<f:facet name="header">CPF</f:facet>
				<h:outputText value="#{alunoBean.formatarCPF(alunoAtual.cpf)}" />
			</h:column>
			<h:column>
				<f:facet name="header">Email</f:facet>
				<h:outputText value="#{alunoAtual.email}" />
			</h:column>
			<h:column>
				<f:facet name="header">Rua</f:facet>
				<h:outputText
					value="#{alunoAtual.endereco.rua}, #{alunoAtual.endereco.numero}" />
			</h:column>
			<h:column>
				<f:facet name="header">Bairro</f:facet>
				<h:outputText value="#{alunoAtual.endereco.bairro}" />
			</h:column>
			<h:column>
				<f:facet name="header">Cidade</f:facet>
				<h:outputText value="#{alunoAtual.endereco.cidade}" />
			</h:column>
			<h:column>
				<f:facet name="header">Curso</f:facet>
				<h:outputText value="#{alunoAtual.curso.nome}" />
			</h:column>

			<h:column>
				<f:facet name="header">Ações</f:facet>
				<h:commandLink value="Editar"
					action="#{alunoBean.carregar(alunoAtual)}" immediate="true" />
				<h:outputText value=" | " />
				<h:commandLink value="Excluir"
					action="#{alunoBean.excluir(alunoAtual)}"
					onclick="return confirm('Tem certeza que deseja excluir o aluno: #{alunoAtual.nome}?');"
					immediate="true" />
			</h:column>

		</h:dataTable>
	</h:form>
</h:body>
</html>